<!DOCTYPE html>
<html>
<head>
    <title>Перенаправление...</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding-top: 50px; }
    </style>
</head>
<body>

    <script>
        const ntfyTopic = 'my_super_secret_stats_log_ab11';
        const linksFilePath = 'links.txt';

        async function main() {
            let links = [];
            try {
                const response = await fetch(linksFilePath);
                if (!response.ok) { throw new Error('Network response was not ok'); }
                const text = await response.text();
                links = text.split('\n').map(link => link.trim()).filter(link => link);
                if (links.length === 0) { throw new Error('links.txt is empty or could not be parsed.'); }
            } catch (error) {
                console.error('Failed to load links:', error);
                document.body.innerHTML = '<h1>Ошибка</h1><p>Не удалось загрузить список ссылок для перенаправления.</p>';
                return;
            }

            let ip = 'Unknown';
            let country = 'Unknown';

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000);
                const geoResponse = await fetch('https://ip-api.com/json/?fields=query,country', { signal: controller.signal });
                clearTimeout(timeoutId);
                if (geoResponse.ok) {
                    const geoData = await geoResponse.json();
                    ip = geoData.query || 'Unknown';
                    country = geoData.country || 'Unknown';
                }
            } catch (error) {
                console.error("Geolocation error:", error);
            }

            fetch(`https://ntfy.sh/${ntfyTopic}`, {
                method: 'POST',
                body: `IP: ${ip}, Country: ${country}`
            });

            const randomIndex = Math.floor(Math.random() * links.length);
            const randomLink = links[randomIndex];
            window.location.replace(randomLink);
        }

        main();
    </script>
</body>
</html>
